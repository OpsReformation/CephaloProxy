# Example: Squid Configuration with ACL-based Traffic Filtering
# Use this configuration to block specific domains or IP ranges

# =============================================================================
# Network Configuration
# =============================================================================

http_port 3128

# =============================================================================
# Cache Configuration
# =============================================================================

# PID file location
pid_filename /var/run/squid/squid.pid

cache_dir ufs /var/spool/squid 500 16 256
cache_mem 128 MB
maximum_object_size 10 MB
minimum_object_size 0 KB
cache_replacement_policy heap LFUDA
memory_replacement_policy heap GDSF
coredump_dir /var/cache/squid

# =============================================================================
# Access Control Lists (ACLs)
# =============================================================================

# Standard ACLs
acl SSL_ports port 443
acl Safe_ports port 80 443 21 70 210 1025-65535 280 488 591 777
acl CONNECT method CONNECT

# Local networks
acl localnet src 10.0.0.0/8
acl localnet src 172.16.0.0/12
acl localnet src 192.168.0.0/16

# Blocked domains (from external file)
acl blocked_domains dstdomain "/etc/squid/conf.d/blocked-domains.acl"

# Additional filtering examples:
# acl social_media dstdomain .facebook.com .twitter.com .instagram.com
# acl streaming dstdomain .youtube.com .netflix.com .twitch.tv
# acl blocked_ips dst 192.168.100.0/24

# Time-based ACL example
# acl work_hours time MTWHF 09:00-17:00

# =============================================================================
# Access Rules
# =============================================================================

# Deny blocked domains (apply first)
http_access deny blocked_domains

# Uncomment to enable additional filtering:
# http_access deny social_media
# http_access deny streaming !work_hours  # Block streaming outside work hours
# http_access deny blocked_ips

# Standard safety rules
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

# Allow localhost management
http_access allow localhost manager
http_access deny manager

# Allow local network access
http_access allow localnet
http_access allow localhost

# Deny all other access
http_access deny all

# =============================================================================
# Logging
# =============================================================================

access_log stdio:/var/log/squid/access.log squid
cache_log stdio:/var/log/squid/cache.log
debug_options ALL,1
# Note: log_fqdn is deprecated. Use %>A in log format to log FQDN

# =============================================================================
# Performance Tuning
# =============================================================================

refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320

# =============================================================================
# Miscellaneous
# =============================================================================

visible_hostname cephaloproxy

# =============================================================================
# Usage Instructions
# =============================================================================
#
# 1. Copy this file to your host:
#    cp config-examples/filtering/squid.conf /path/to/your/squid.conf
#
# 2. Create your blocked domains ACL file:
#    echo ".facebook.com" > /path/to/blocked-domains.acl
#    echo ".twitter.com" >> /path/to/blocked-domains.acl
#
# 3. Mount both files when running the container:
#    docker run -d \
#      -v /path/to/squid.conf:/etc/squid/squid.conf:ro \
#      -v /path/to/blocked-domains.acl:/etc/squid/conf.d/blocked-domains.acl:ro \
#      -p 3128:3128 -p 8080:8080 \
#      cephaloproxy:latest
#
# 4. Test blocking:
#    curl -x http://localhost:3128 -I http://facebook.com  # Should be blocked
#    curl -x http://localhost:3128 -I http://example.com   # Should work
