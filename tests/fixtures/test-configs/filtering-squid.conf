# Test Squid configuration with ACL filtering
# Used for integration testing of User Story 2

# Proxy port
http_port 3128

# PID file location
pid_filename /var/run/squid/squid.pid

# Cache configuration
cache_dir ufs /var/spool/squid 250 16 256
cache_mem 64 MB
maximum_object_size 4 MB

# Core dumps directory
coredump_dir /var/cache/squid

# =============================================================================
# Access Control Lists (ACLs)
# =============================================================================

# Standard ACLs
acl SSL_ports port 443
acl Safe_ports port 80 443 21 70 210 1025-65535 280 488 591 777
acl CONNECT method CONNECT

# Local networks
acl localnet src 10.0.0.0/8
acl localnet src 172.16.0.0/12
acl localnet src 192.168.0.0/16
acl localnet src fc00::/7
acl localnet src fe80::/10

# Blocked domains ACL (external file)
acl blocked_domains dstdomain "/etc/squid/conf.d/blocked-domains.acl"

# =============================================================================
# Access Rules
# =============================================================================

# Deny blocked domains FIRST
http_access deny blocked_domains

# Standard safety rules
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

# Allow localhost management
http_access allow localhost manager
http_access deny manager

# Allow local network access
http_access allow localnet
http_access allow localhost

# Deny all other access
http_access deny all

# =============================================================================
# Logging
# =============================================================================

access_log stdio:/var/log/squid/access.log squid
cache_log stdio:/var/log/squid/cache.log
debug_options ALL,1

# =============================================================================
# Performance
# =============================================================================

refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320

# Miscellaneous
visible_hostname cephaloproxy-test
